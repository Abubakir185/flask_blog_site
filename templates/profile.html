{% extends "base.html" %}
{% block content %}
<div class="container py-5">
  <div class="row align-items-center mb-4">
    <div class="col-md-3 text-center">
      <img src="{{ current_user.avatar_url or url_for('static', filename='default-avatar.png') }}"
           alt="Profil rasmi"
           class="rounded-circle"
           style="width: 150px; height: 150px; object-fit: cover;">

      <form action="{{ url_for('upload_avatar') }}" method="POST" enctype="multipart/form-data" class="mt-3">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <input type="file" name="avatar" accept="image/*" class="form-control mb-2" required>
        <button type="submit" class="btn btn-sm btn-outline-secondary">Profil rasmni o‘zgartirish</button>
      </form>
    </div>

    <div class="col-md-9">
      <h3>{{ current_user.fullname }}</h3>
      <p class="text-muted">{{ current_user.username }}</p>
      <a href="{{ url_for('create_post') }}" class="btn btn-success">Yangi post qo‘shish</a>
    </div>
  </div>

  <hr>
  <h4 class="mb-3">Oxirgi Bloglarim</h4>
  <div class="row row-cols-1 row-cols-md-2 g-4">
    {% for post in bloglar %}
      <div class="col">
        <div class="card h-100">
          {% if post.image %}
          <img src="{{ post.image }}" class="card-img-top" style="height: 180px; object-fit: cover;">
          {% endif %}
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">{{ post.title }}</h5>
            <p class="text-truncate">{{ post.content }}</p>

            {% if post.categories %}
              <div class="mb-3">
                {% for cat in post.categories %}
                  <span class="badge bg-primary me-1">{{ cat.name }}</span>
                {% endfor %}
              </div>
            {% endif %}
            
            <p class="text-muted mt-auto">📅 {{ post.date_posted.strftime('%Y-%m-%d') }}</p>
            <div class="mt-2 d-flex justify-content-between">
              <a href="{{ url_for('edit_post', id=post.id) }}" class="btn btn-sm btn-outline-primary">✏️</a>
              <form action="{{ url_for('delete_post', id=post.id) }}" method="POST" onsubmit="return confirm('Haqiqatan o‘chirmoqchimisiz?');">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="btn btn-sm btn-outline-danger">🗑️</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
